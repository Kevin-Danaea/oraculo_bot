# üîÆ Or√°culo Cripto Bot - Arquitectura de Pure Workers + API Gateway

Un sistema inteligente de **microservicios pure workers** para trading automatizado y an√°lisis de noticias crypto con **API Gateway centralizado** y **health checks HTTP** en tiempo real.

## üìã Descripci√≥n del Proyecto

El **Or√°culo Cripto Bot** es un ecosistema de **pure workers** con **API Gateway centralizado** que combina **trading automatizado** y **an√°lisis de sentimientos** de noticias cripto. La arquitectura est√° dise√±ada como **microservicios modernos** donde cada worker es independiente y el gateway agrega su estado mediante **health checks HTTP**.

### üéØ Arquitectura: Pure Workers + Gateway Centralizado

#### üì∞ News Worker (Puerto 8000)
- **Recolecci√≥n Autom√°tica**: Reddit (r/CryptoCurrency) cada hora
- **An√°lisis de Sentimientos**: Google Gemini AI cada 4 horas  
- **Background Jobs**: Schedulers independientes
- **Minimal API**: Solo `/health` para monitoreo

#### ü§ñ Grid Worker (Puerto 8001)
- **Grid Trading Bot**: Estrategias automatizadas en Binance
- **Trading 24/7**: Operaciones continuas con gesti√≥n de riesgos
- **Background Jobs**: Schedulers de trading independientes
- **Minimal API**: Solo `/health` para monitoreo

#### üåê API Gateway (Puerto 8002)
- **√önico Punto HTTP**: Entrada p√∫blica centralizada
- **Health Checks Agregados**: Estado de todos los workers v√≠a HTTP
- **Monitoreo Centralizado**: `/api/v1/health` agrega todo el sistema
- **Communication Hub**: Comunica con workers via `localhost:8000` y `localhost:8001`

### üèóÔ∏è Arquitectura Final Optimizada

```
oraculo_bot/
‚îú‚îÄ‚îÄ services/                    # üî• MICROSERVICIOS PURE WORKERS
‚îÇ   ‚îú‚îÄ‚îÄ api/                     # üåê API Gateway (Puerto 8002) - P√öBLICO
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Entry point √∫nico HTTP
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ status_router.py # Health checks agregados HTTP
‚îÇ   ‚îú‚îÄ‚îÄ news/                    # üì∞ News Worker (Puerto 8000) - WORKER PURO
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # Minimal FastAPI + Background jobs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schedulers/          # Reddit + Sentiment analysis jobs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/            # Reddit API + Google Gemini AI
‚îÇ   ‚îî‚îÄ‚îÄ grid/                    # ü§ñ Grid Worker (Puerto 8001) - WORKER PURO
‚îÇ       ‚îú‚îÄ‚îÄ main.py              # Minimal FastAPI + Trading jobs
‚îÇ       ‚îú‚îÄ‚îÄ schedulers/          # Grid trading background jobs
‚îÇ       ‚îú‚îÄ‚îÄ core/                # Trading engine
‚îÇ       ‚îî‚îÄ‚îÄ strategies/          # Trading algorithms
‚îú‚îÄ‚îÄ shared/                      # üß© C√ìDIGO COMPARTIDO
‚îÇ   ‚îú‚îÄ‚îÄ config/                  # Configuraci√≥n centralizada
‚îÇ   ‚îú‚îÄ‚îÄ database/                # SQLite compartido (sentimientos)
‚îÇ   ‚îî‚îÄ‚îÄ services/                # Logging + Telegram compartidos
‚îú‚îÄ‚îÄ run_api_service.py           # üöÄ Entry point API Gateway
‚îú‚îÄ‚îÄ run_news_service.py          # üöÄ Entry point News Worker
‚îú‚îÄ‚îÄ run_grid_service.py          # üöÄ Entry point Grid Worker
‚îî‚îÄ‚îÄ requirements.txt             # Dependencias (incluye aiohttp)
```

### üîó Comunicaci√≥n Entre Microservicios

```mermaid
graph LR
    A[üë§ Usuario/Nginx] -->|HTTP| B[üåê API Gateway :8002]
    B -->|Health Check HTTP| C[üì∞ News Worker :8000]
    B -->|Health Check HTTP| D[ü§ñ Grid Worker :8001]
    C -->|SQLite| E[(üóÑÔ∏è DB Compartida)]
    D -->|SQLite| E
    C -->|Background| F[üì° Reddit API]
    C -->|Background| G[üß† Google Gemini]
    D -->|Background| H[üíπ Binance API]
```

#### üîß Flujo de Health Checks

1. **API Gateway** (Puerto 8002) hace HTTP requests a:
   - `http://localhost:8000/health` (News Worker)
   - `http://localhost:8001/health` (Grid Worker)

2. **Endpoint Agregado** `/api/v1/health` retorna estado completo:
   ```json
   {
     "system_status": "healthy",
     "summary": "3/3 servicios saludables",
     "services": [
       {"service": "api_gateway", "status": "healthy", "url": "localhost:8002"},
       {"service": "news", "status": "healthy", "url": "localhost:8000"},
       {"service": "grid", "status": "healthy", "url": "localhost:8001"}
     ]
   }
   ```

## üöÄ Instalaci√≥n y Configuraci√≥n

### üìã Prerrequisitos

- Python 3.8 o superior
- pip (gestor de paquetes de Python)
- **Cuenta de Reddit** para API credentials
- **Google API Key** para an√°lisis de sentimientos con Gemini
- **Cuenta de Binance** para trading (opcional)
- **Bot de Telegram** para notificaciones (opcional)

### üîß Instalaci√≥n Local

1. **Clonar el repositorio**:
   ```bash
   git clone <url-del-repositorio>
   cd oraculo_bot
   ```

2. **Crear y activar el entorno virtual**:
   ```bash
   # En Windows
   python -m venv venv
   venv\Scripts\activate

   # En macOS/Linux
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **Instalar las dependencias**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Configurar variables de entorno**:
   
   Crear un archivo `.env` en la ra√≠z del proyecto:
   ```env
   # Configuraci√≥n General
   PROJECT_NAME=Or√°culo Cripto Bot
   DATABASE_URL=sqlite:///./oraculo.db
   
   # Reddit API (para noticias)
   REDDIT_CLIENT_ID=tu_client_id_aqui
   REDDIT_CLIENT_SECRET=tu_client_secret_aqui
   REDDIT_USER_AGENT=OraculoBot by tu_usuario_de_reddit
   
   # Google Gemini API (para an√°lisis de sentimientos)
   GOOGLE_API_KEY=tu_google_api_key_aqui
   
   # Binance API (para trading)
   BINANCE_API_KEY=tu_binance_api_key_aqui
   BINANCE_SECRET_KEY=tu_binance_secret_key_aqui
   
   # Telegram Bot (para notificaciones)
   TELEGRAM_BOT_TOKEN=tu_telegram_bot_token
   TELEGRAM_CHAT_ID=tu_chat_id
   ```

## üéÆ Ejecuci√≥n del Proyecto

### üî• Ejecutar Pure Workers + API Gateway

```bash
# üì∞ News Worker (Puerto 8000) - Background jobs
python run_news_service.py

# ü§ñ Grid Trading Worker (Puerto 8001) - Background jobs  
python run_grid_service.py

# üåê API Gateway (Puerto 8002) - HTTP p√∫blico
python run_api_service.py
```

### üåê URLs del Sistema

- **üåê API Gateway**: http://localhost:8002 (√öNICO PUNTO P√öBLICO)
  - **Documentaci√≥n**: http://localhost:8002/docs
  - **Health Check Sistema**: http://localhost:8002/api/v1/health
  - **Lista Workers**: http://localhost:8002/api/v1/services
- **üì∞ News Worker**: http://localhost:8000/health (INTERNO)
- **ü§ñ Grid Worker**: http://localhost:8001/health (INTERNO)

### üì° Endpoints del API Gateway Centralizado

#### üåê Sistema (`/api/v1/`)
| M√©todo | Endpoint | Descripci√≥n |
|--------|----------|-------------|
| GET | `/` | Informaci√≥n general del sistema y arquitectura |
| GET | `/api/v1/health` | **Health check agregado** de todos los workers |
| GET | `/api/v1/services` | Lista de workers y sus puertos |
| GET | `/api/v1/` | Estado general y informaci√≥n arquitect√≥nica |

#### üîç Ejemplos de Monitoreo

1. **Health check completo del sistema**:
   ```bash
   curl http://localhost:8002/api/v1/health
   ```
   
   **Respuesta**: Estado agregado de todos los workers con comunicaci√≥n HTTP real

2. **Lista de workers disponibles**:
   ```bash
   curl http://localhost:8002/api/v1/services
   ```

3. **Informaci√≥n del sistema**:
   ```bash
   curl http://localhost:8002/
   ```

4. **Health check individual de worker** (interno):
   ```bash
   curl http://localhost:8000/health  # News Worker
   curl http://localhost:8001/health  # Grid Worker
   ```

## üê≥ Deployment en VPS

### üõ†Ô∏è Configuraci√≥n con Systemd (Pure Workers)

El proyecto mantiene compatibilidad con systemd services en `deployment/services/`:

```bash
# Copiar archivos de servicio
sudo cp deployment/services/*.service /etc/systemd/system/

# Habilitar servicios (workers independientes)
sudo systemctl enable oraculo-news    # News Worker (Puerto 8000)
sudo systemctl enable oraculo-grid    # Grid Worker (Puerto 8001)  
sudo systemctl enable oraculo-api     # API Gateway (Puerto 8002)

# Iniciar servicios
sudo systemctl start oraculo-news
sudo systemctl start oraculo-grid  
sudo systemctl start oraculo-api

# Verificar estado
sudo systemctl status oraculo-*
```

### üåê Configuraci√≥n Nginx (Solo API Gateway P√∫blico)

```nginx
server {
    listen 80;
    server_name tu-dominio.com;

    # Solo exponer API Gateway p√∫blico
    location / {
        proxy_pass http://localhost:8002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # Workers internos no expuestos p√∫blicamente
    # News Worker (8000) y Grid Worker (8001) solo acceso local
}
```

### üìä Monitoreo en VPS

```bash
# Health check agregado (muestra estado de todos los workers)
curl http://tu-vps:8002/api/v1/health

# Logs de servicios independientes
journalctl -u oraculo-news -f    # News Worker logs
journalctl -u oraculo-grid -f    # Grid Worker logs
journalctl -u oraculo-api -f     # API Gateway logs

# Estado de workers
sudo systemctl status oraculo-*
```

## üõ†Ô∏è Tecnolog√≠as Utilizadas

### üöÄ Framework y Comunicaci√≥n
- **[FastAPI](https://fastapi.tiangolo.com/)**: Framework para API Gateway y workers
- **[aiohttp](https://docs.aiohttp.org/)**: **Health checks HTTP** entre servicios
- **[SQLAlchemy](https://www.sqlalchemy.org/)**: ORM compartido
- **[SQLite](https://www.sqlite.org/)**: Base de datos compartida
- **[APScheduler](https://apscheduler.readthedocs.io/)**: Background jobs en workers

### ü§ñ Integrations
- **[PRAW](https://praw.readthedocs.io/)**: Reddit API integration
- **[Google Gemini](https://ai.google.dev/)**: An√°lisis de sentimientos con IA
- **[Binance API](https://github.com/sammchardy/python-binance)**: Trading automatizado
- **[python-telegram-bot](https://python-telegram-bot.org/)**: Notificaciones

### üîß Infraestructura
- **[Uvicorn](https://www.uvicorn.org/)**: Servidor ASGI para cada worker
- **[Pydantic](https://pydantic-docs.helpmanual.io/)**: Validaci√≥n de datos
- **Systemd**: Gesti√≥n de servicios en VPS

## üîÆ Caracter√≠sticas Avanzadas

### ü§ñ Pure Workers Architecture
- **Independent Processes**: Cada worker es un proceso separado
- **Minimal APIs**: Solo endpoints `/health` para monitoreo
- **Background Focus**: L√≥gica de negocio en background jobs
- **Fault Isolation**: Fallos en un worker no afectan otros

### üåê API Gateway Centralizado
- **Single Entry Point**: Un solo puerto p√∫blico (8002)
- **Health Aggregation**: Comunica con workers v√≠a HTTP
- **Service Discovery**: Conoce ubicaci√≥n de todos los workers
- **Monitoring Hub**: Dashboard centralizado del sistema

### üîó Inter-Service Communication
- **HTTP Health Checks**: Comunicaci√≥n real entre servicios
- **Timeout Handling**: 5 segundos timeout para health checks
- **Parallel Checks**: Verifica todos los workers simult√°neamente
- **Graceful Degradation**: Sistema funciona aunque un worker falle

### üõ°Ô∏è Monitoring y Observabilidad
- **Aggregated Health**: Un endpoint muestra estado de todo
- **Individual Health**: Cada worker expone su estado
- **Service Discovery**: Lista autom√°tica de workers disponibles
- **Error Isolation**: Errores no se propagan entre servicios

## üîÆ Roadmap y Funcionalidades Futuras

### üöÄ Arquitectura
- **Kubernetes Deployment**: Migraci√≥n a K8s con health checks
- **Load Balancing**: M√∫ltiples instancias de workers
- **Service Mesh**: Istio para comunicaci√≥n avanzada
- **Distributed Tracing**: OpenTelemetry para observabilidad

### üß† Workers Adicionales
- **Sentiment Aggregator Worker**: An√°lisis de sentimientos agregados
- **Notification Worker**: Worker dedicado para notificaciones
- **Analytics Worker**: M√©tricas y analytics en tiempo real
- **Alert Worker**: Sistema de alertas inteligentes

### üîó Integraciones Futuras
- **Multiple Exchanges**: M√°s exchanges de trading
- **Social Media Workers**: Twitter, Discord, Telegram sentiment
- **News API Workers**: M√°s fuentes de noticias crypto
- **DeFi Protocol Workers**: Integraci√≥n con protocolos DeFi

## ü§ù Contribuciones

Las contribuciones son bienvenidas. El proyecto sigue **arquitectura de pure workers**:

1. Haz fork del proyecto
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. **Desarrolla workers puros**: Enf√≥cate en background jobs, no APIs complejas
4. **Mant√©n health checks**: Agrega `/health` a nuevos workers
5. **Actualiza API Gateway**: Si necesitas nuevos endpoints de monitoreo
6. Commit tus cambios (`git commit -am 'Agregar nueva funcionalidad'`)
7. Push a la rama (`git push origin feature/nueva-funcionalidad`)
8. Abre un Pull Request

## üìù Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

---

## üèÜ Pure Workers + API Gateway Architecture

**El Or√°culo Cripto Bot** representa una implementaci√≥n moderna de **pure workers** con **API Gateway centralizado**, donde cada worker se enfoca en sus background jobs espec√≠ficos y el gateway agrega su estado mediante **health checks HTTP reales**. 

Esta arquitectura garantiza:
- ‚úÖ **Separaci√≥n total** de responsabilidades
- ‚úÖ **Comunicaci√≥n HTTP** real entre servicios  
- ‚úÖ **Monitoreo centralizado** agregado
- ‚úÖ **Fault isolation** completo
- ‚úÖ **Escalabilidad independiente** por worker

**Desarrollado con ‚ù§Ô∏è para arquitectura de microservicios moderna y trading automatizado** 